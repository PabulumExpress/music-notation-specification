<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Document</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="Description">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify/lib/themes/vue.css">
  </head>
  <body>
    <nav>
      <a href="#/">EN</a>
      <a href="#/zh-cn/">中文</a>
    </nav>
    <div id="app"></div>
     <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
      var lilypond_server = `http://${location.hostname}:8081`;
      mermaid.mermaidAPI.initialize({
          startOnLoad:false
      });
      window.$docsify = {
        loadSidebar: true,
        name: '',
        repo: '',
        plugins: [
          function(hook, vm) {
            hook.beforeEach(function(content) {
              var ly_umls = content.match(/```lilypond\n(.|\n)*?```/gim);
              if (ly_umls instanceof Array) {
                for (var i = 0, len = ly_umls.length; i < len; i++) {
                  var ly = ly_umls[i].replace(/```lilypond/i, '').replace(/```\s*$/i, '');
                  content = content.replace(
                    ly_umls[i],
                    `![lilypond](${lilypond_server}?data=${encodeURIComponent(btoa(ly))})`,
                  );
                }
              }

              return content;
            });

            hook.afterEach(async function(html, next) {
              var q = [];
              var doc = new DOMParser().parseFromString(html, "text/html");
              doc.querySelectorAll('[data-lang=mermaid]').forEach(function(mermaid_el) {
                var mermaid_data = mermaid_el.firstElementChild.innerText;
                var f = async function(svg_code) {
                  mermaid_el.innerHTML = svg_code;
                };
                q.push(f);
                mermaid.mermaidAPI.render('graphDiv', mermaid_data, f);
              });

              await Promise.all(q);

              next(doc.firstElementChild.innerHTML);
            });
          }
        ]
      }
    </script>
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js"></script>
  </body>
</html>
